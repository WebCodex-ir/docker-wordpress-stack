# ุงุณุชฺฉ ุฏุงฺฉุฑ ูุฑุฏูพุฑุณ ุจุง ุนููฺฉุฑุฏ ุจุงูุง

ุงู ูพุฑูฺู ฺฉ ูุงูุจ ุขูุงุฏู ู ุญุฑููโุง ุจุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉ ุง ฺูุฏ ุณุงุช ูุฑุฏูพุฑุณ ุจุณุงุฑ ุณุฑุนุ ุงูู ู ุจููู ุจุง ุงุณุชูุงุฏู ุงุฒ Docker ุงุณุช. ุชูุงู ูุฑุขูุฏูุง ุจุฑุง ูุตุจ ุขุณุงู ู ุณุฑุนุ ุฎูุฏฺฉุงุฑ ุดุฏูโุงูุฏ.

## ูุนูุงุฑ ๐๏ธ

ุงู ุงุณุชฺฉ ุงุฒ ุจูุชุฑู ุงุจุฒุงุฑูุง ูุฏุฑู ุจุฑุง ุงุฌุฑุง ูุฑุฏูพุฑุณ ุงุณุชูุงุฏู ูโฺฉูุฏ:
* **Reverse Proxy:** **Traefik** (ุจุฑุง ูุณุฑุงุจ ููุดููุฏ ู ูุฏุฑุช ุฎูุฏฺฉุงุฑ SSL)
* **ูุจ ุณุฑูุฑ:** **Nginx** (ุจุฑุง ุณุฑูุณโุฏู ุจู ูุงูโูุง ูุฑุฏูพุฑุณ ู ุงุฑุชุจุงุท ุจุง PHP)
* **ุงูพูฺฉุดู:** **WordPress** (ุงุฌุฑุง ุดุฏู ุฑู ุขุฎุฑู ูุณุฎู PHP-FPM)
* **ุฏุชุงุจุณ:** **MariaDB** (ุฌุงฺฏุฒู ุณุฑุนโุชุฑ ู ุจูููโุชุฑ MySQL)
* **ฺฉุดูฺฏ:** **Redis** (ุจุฑุง ฺฉุด ุขุจุฌฺฉุชโูุง ู ุงูุฒุงุด ฺุดูฺฏุฑ ุณุฑุนุช)
* **ฺฉูุชุฑู ูพูู:** **Portainer** (ุฑุงุจุท ฺฏุฑุงูฺฉ ุจุฑุง ูุฏุฑุช ุฏุงฺฉุฑ)

## ูพุดโูุงุฒูุง ๐

1.  ฺฉ ุณุฑูุฑ ุจุง ุณุณุชู ุนุงูู **Ubuntu 22.04 / 24.04**.
2.  ฺฉ **ุฏุงููู** ฺฉู Nameserver ูุง ุขู ุฑู **Cloudflare** ุชูุธู ุดุฏู ุจุงุดุฏ.
3.  ฺฉ **ุชูฺฉู API ุงุฒ ฺฉููุฏููุฑ** (Cloudflare API Token) ุจุง ุฏุณุชุฑุณ `Edit zone DNS`.

## ุฑุงูููุง ุฑุงูโุงูุฏุงุฒ ุณุฑุน (ูุตุจ ูุฑุฏูพุฑุณ ุฎุงู) ๐

ุงู ุฑุงูููุง ฺฉ ูุฑุฏูพุฑุณ ุฎุงู ู ุฌุฏุฏ ุฑุง ุจุฑุง ุดูุง ุฑุงูโุงูุฏุงุฒ ูโฺฉูุฏ.

1.  **ุขูุงุฏูโุณุงุฒ ุงููู:** ุจุง SSH ุจู ุณุฑูุฑ ูุชุตู ุดุฏู ู ูพุฑูฺู ุฑุง ุงุฒ ฺฏุชโูุงุจ ฺฉููู ฺฉูุฏ:
    ```bash
    git clone https://github.com/WebCodex-ir/docker-wordpress-stack.git
    cd docker-wordpress-stack
    ```
2.  **ูพฺฉุฑุจูุฏ:** ูุงู `.env.example` ุฑุง ุจู `.env` ฺฉูพ ฺฉุฑุฏู ู ุจุง ุงุทูุงุนุงุช ุตุญุญ ุฎูุฏ (ุฏุงูููุ ุงูู ู ุชูฺฉู ฺฉููุฏููุฑ ู ุฑูุฒูุง ุฏุชุงุจุณ) ูพุฑ ฺฉูุฏ.
    ```bash
    cp .env.example .env
    nano .env
    ```
3.  **ุงุฌุฑุง ุงุณฺฉุฑูพุช:** ุงุณฺฉุฑูพุช ูุตุจ ุฑุง ูุงุจู ุงุฌุฑุง ฺฉุฑุฏู ู ุขู ุฑุง ุงุฌุฑุง ฺฉูุฏ.
    ```bash
    chmod +x install.sh
    sudo ./install.sh
    ```
4.  **ุชูุธูุงุช DNS:** ุฏุฑ ฺฉููุฏููุฑุ ฺฉ ุฑฺฉูุฑุฏ `A` ุจุฑุง ุฏุงููู ุฎูุฏ ุจุณุงุฒุฏ ฺฉู ุจู IP ุณุฑูุฑ ุงุดุงุฑู ฺฉูุฏ ู ุญุงูุช SSL ุฑุง ุฑู **Full (Strict)** ูุฑุงุฑ ุฏูุฏ.
5.  **ูุตุจ ูุฑุฏูพุฑุณ:** ูพุณ ุงุฒ ฺูุฏ ุฏูููุ ุจู ุขุฏุฑุณ ุฏุงููู ุฎูุฏ ุจุฑูุฏ ู ูุฑุงุญู ูุตุจ ต ุฏูููโุง ูุฑุฏูพุฑุณ ุฑุง ุชฺฉูู ฺฉูุฏ.

---
## ุฑุงูููุง ุงูุชูุงู ฺฉุงูู ุณุงุช (ุฑูุด ุฏุณุช ู ุญุฑููโุง) ๐

ุงู ุฑูุด ูพุดููุงุฏ ู ูุทูุฆูโุชุฑู ุฑุงู ุจุฑุง ุงูุชูุงู ฺฉ ุณุงุช ููุฌูุฏ ุงุณุช.

**ูุฑุญูู ฑ: ุขูุงุฏูโุณุงุฒ ุจฺฉโุขูพ ุฏุฑ ุณุฑูุฑ ูุฏู**
- ุงุฒ ฺฉูุชุฑู ูพูู ุฎูุฏ (ูุซูุงู ุฏุงุฑฺฉุช ุงุฏูู) ฺฉ **ุจฺฉโุขูพ ฺฉุงูู** ุชูู ู ุขู ุฑุง ุฏุงูููุฏ ฺฉูุฏ. ุงู ุจฺฉุงูพ ุดุงูู ฺฉ ูพูุดู `domains` (ุญุงู ูุงูโูุง ุณุงุช ูุงููุฏ `wp-content`) ู ฺฉ ูพูุดู `backup` (ุญุงู ูุงู ุฏุชุงุจุณ ุจุง ูพุณููุฏ `.sql`) ุงุณุช.

**ูุฑุญูู ฒ: ุฑุงูโุงูุฏุงุฒ ุณุฑูุฑ ุฌุฏุฏ**
- ูุฑุงุญู ฑ ุชุง ณ ุฑุงูููุง ูุตุจ ุณุฑุน ุฑุง ุงูุฌุงู ุฏูุฏ ุชุง ฺฉ ูุฑุฏูพุฑุณ ุฎุงู ุฑู ุณุฑูุฑ ุฌุฏุฏ ุดูุง ุจุงูุง ุจุงุฏ.

**ูุฑุญูู ณ: ุงูุชูุงู ูุงูโูุง ู ุฏุชุงุจุณ**
- ูุงู ุจฺฉโุขูพ (`.tar.gz`) ุฑุง ุฑู ุณุฑูุฑ ุฌุฏุฏ (ูุซูุงู ุฏุฑ ูพูุดู `/root/`) ุขูพููุฏ ฺฉุฑุฏู ู ุจุง ุฏุณุชูุฑ `tar -xvzf your-backup.tar.gz` ุขู ุฑุง ุงุฒ ุญุงูุช ูุดุฑุฏู ุฎุงุฑุฌ ฺฉูุฏ.

**ูุฑุญูู ด: ุฌุงฺฏุฒู ูุงูโูุง ู ุฏุชุงุจุณ**
1.  **ูุชููู ฺฉุฑุฏู ุณุฑูุณโูุง:**
    ```bash
    sudo docker compose down
    ```
2.  **ูพุงฺฉ ฺฉุฑุฏู ูุญุชูุงุช ูพุดโูุฑุถ:**
    ```bash
    sudo rm -rf ./data/wordpress/*
    sudo rm -rf ./data/mariadb/*
    ```
3.  **ฺฉูพ ฺฉุฑุฏู ูุงูโูุง ุณุงุช ูุฏู:**
    ูพูุดู `wp-content` ู ุณุงุฑ ูุงูโูุง ูุฑุฏูพุฑุณ ุฑุง ุงุฒ ุจฺฉโุขูพ ุงุณุชุฎุฑุงุฌ ุดุฏู ุจู ูุณุฑ `./data/wordpress/` ฺฉูพ ฺฉูุฏ.
    ```bash
    # ูุณุฑ ุจฺฉโุขูพ ุฎูุฏ ุฑุง ุฌุงฺฏุฒู ฺฉูุฏ
    sudo cp -r /path/to/extracted_backup/domains/[your-old-domain.com/public_html/](https://your-old-domain.com/public_html/)* ./data/wordpress/
    ```
4.  **ุฑุงูโุงูุฏุงุฒ ุฏุชุงุจุณ ู ูุฑุฏูพุฑุณ:**
    ```bash
    sudo docker compose up -d mariadb wordpress
    ```
5.  **ุฏุฑููโุฑุฒ ุฏุชุงุจุณ:**
    ูุงู `.sql` ุฑุง ุจู ุฏุชุงุจุณ ุฌุฏุฏ ูุงุฑุฏ ฺฉูุฏ (ููุงุฏุฑ ุฑุง ุงุฒ ูุงู `.env` ุฎูุฏ ุฌุงฺฏุฒู ฺฉูุฏ).
    ```bash
    sudo docker exec -i mariadb mariadb -uYOUR_DB_USER -pYOUR_DB_PASSWORD YOUR_DB_NAME < /path/to/your/database.sql
    ```

**ูุฑุญูู ต: ุงุตูุงุญุงุช ููุง (ุจุณุงุฑ ููู)**
1.  **ุฌุงฺฏุฒู ุขุฏุฑุณ ุฏุงููู ุฏุฑ ุฏุชุงุจุณ:**
    ```bash
    # ุจู ุฌุง your-old-domain.com ุขุฏุฑุณ ุณุงุช ูุฏู ุฑุง ูุงุฑุฏ ฺฉูุฏ
    sudo docker compose run --rm wp-cli wp search-replace '[https://your-old-domain.com](https://your-old-domain.com)' '[https://your-new-domain.com](https://your-new-domain.com)' --all-tables
    ```
2.  **ุฌุงฺฏุฒู ูุณุฑูุง ูุงู ุฏุฑ ุฏุชุงุจุณ:**
    ```bash
    # ุจู ุฌุง /home/user/domains/... ูุณุฑ ูุฏู ุฑุง ูุงุฑุฏ ฺฉูุฏ
    sudo docker compose run --rm wp-cli wp search-replace '/home/user/domains/[old-domain.com/public_html](https://old-domain.com/public_html)' '/var/www/html' --all-tables
    ```
3.  **ุฑุงูโุงูุฏุงุฒ ฺฉุงูู ุณุฑูุณโูุง:**
    ```bash
    sudo docker compose up -d
    ```
4.  **ุชูุธู ุฏุณุชุฑุณ ูุงูโูุง (ุฏุณุชูุฑ ฺฉูุฏ):**
    ุงู ุฏุณุชูุฑ ููุง ุจุฑุง ุญู ูุดฺฉูุงุช ุขูพุฏุช ู ุฏุณุชุฑุณ ุงุณุช.
    ```bash
    sudo chown -R www-data:www-data ./data/wordpress/
    ```
5.  **ูุฑูุฏ ู ุฐุฎุฑู ูพููุฏูุง ฺฉุชุง:**
    ูุงุฑุฏ ูพุดุฎูุงู ูุฑุฏูพุฑุณ ุดูุฏุ ุจู **ุชูุธูุงุช > ูพููุฏูุง ฺฉุชุง** ุจุฑูุฏ ู ุฏู ุจุงุฑ ุฑู ุฏฺฉูู **"ุฐุฎุฑู ุชุบุฑุงุช"** ฺฉูฺฉ ฺฉูุฏ.

---
## ูุฏุฑุช ูพุดุฑูุชู ู ุฏุณุชูุฑุงุช ููุฏ โ๏ธ

* **ุงูุฒูุฏู ุฏุงููู ุง ุณุงุจโุฏุงูู ุฌุฏุฏ:**
  ุจู ุจุฎุด ูุฑุจูุทู ุฏุฑ ูุงู `docker-compose.yml` ฺฉ ุณุฑูุณ ุฌุฏุฏ (ุดุงูู `nginx`, `wordpress`, `mariadb`) ุจุง ูุงูโูุง ู ูพูุดูโูุง ููุญุตุฑ ุจู ูุฑุฏ ุงุถุงูู ฺฉูุฏ ู ุฏุฑ ุจุฎุด `labels` ุขูุ `Host(\`new-domain.com\`)` ุฑุง ุจุง ุฏุงููู ุฌุฏุฏ ุฎูุฏ ูุดุฎุต ฺฉูุฏ.

* **ฺฏุฑูุชู ุจฺฉุงูพ ฺฉุงูู:**
    ```bash
    sudo tar -czvf backup-$(date +%Y-%m-%d).tar.gz ./data
    ```

* **ุจุงุฒฺฏุฑุฏุงู ุจฺฉุงูพ ฺฉุงูู:**
    ูพุฑูฺู ุฑุง ุงุฒ ฺฏุช ฺฉููู ฺฉูุฏุ ูุงู ุจฺฉุงูพ ุฑุง ุฏุฑ ุขู ุขูพููุฏ ู ุจุง ุฏุณุชูุฑ `sudo tar -xzvf your-backup-file.tar.gz` ุงุณุชุฎุฑุงุฌ ฺฉูุฏ. ุณูพุณ `sudo docker compose up -d` ุฑุง ุงุฌุฑุง ููุงุฏ.

* **ูุดุงูุฏู ฺฉุงูุชูุฑูุง:** `sudo docker ps`
* **ูุดุงูุฏู ูุงฺฏโูุง:** `sudo docker compose logs -f <service_name>`
* **ูุชููู ฺฉุฑุฏู ุณุฑูุณโูุง:** `sudo docker compose down`
* **ุดุฑูุน ูุฌุฏุฏ ุณุฑูุณโูุง:** `sudo docker compose up -d`
