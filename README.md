# استک داکر وردپرس با عملکرد بالا

این پروژه یک قالب آماده و حرفه‌ای برای راه‌اندازی یک یا چند سایت وردپرسی بسیار سریع، امن و بهینه با استفاده از Docker است. تمام فرآیندها برای نصب آسان و سریع، خودکار شده‌اند.

## معماری 🏗️

این استک از بهترین ابزارهای مدرن برای اجرای وردپرس استفاده می‌کند:
* **Reverse Proxy:** **Traefik** (برای مسیریابی هوشمند و مدیریت خودکار SSL)
* **وب سرور:** **Nginx** (برای سرویس‌دهی به فایل‌های وردپرس و ارتباط با PHP)
* **اپلیکیشن:** **WordPress** (اجرا شده روی آخرین نسخه PHP-FPM)
* **دیتابیس:** **MariaDB** (جایگزین سریع‌تر و بهینه‌تر MySQL)
* **کشینگ:** **Redis** (برای کش آبجکت‌ها و افزایش چشمگیر سرعت)
* **کنترل پنل:** **Portainer** (رابط گرافیکی برای مدیریت داکر)

## پیش‌نیازها 📋

1.  یک سرور با سیستم عامل **Ubuntu 22.04 / 24.04**.
2.  یک **دامنه** که Nameserver های آن روی **Cloudflare** تنظیم شده باشد.
3.  یک **توکن API از کلودفلر** (Cloudflare API Token) با دسترسی `Edit zone DNS`.

## راهنمای راه‌اندازی و انتقال 🚀

ابتدا مراحل آماده‌سازی اولیه سرور را انجام دهید، سپس بسته به نیاز خود یکی از دو سناریوی زیر را دنبال کنید.

#### **۱. آماده‌سازی اولیه سرور**

با SSH به سرور خود متصل شوید و این ریپازیتوری را کلون کنید:
```bash
git clone [https://github.com/WebCodex-ir/docker-wordpress-stack.git](https://github.com/WebCodex-ir/docker-wordpress-stack.git)
cd docker-wordpress-stack
````

سپس فایل پیکربندی را آماده کنید:

```bash
# فایل نمونه را کپی کنید
cp .env.example .env

# فایل را با اطلاعات خود ویرایش کنید
nano .env
```

در فایل `.env`، تمام مقادیر (`DOMAIN_NAME`, `CLOUDFLARE_EMAIL`, `CLOUDFLARE_DNS_API_TOKEN` و رمزهای عبور دیتابیس) را با دقت پر کنید. در نهایت، اسکریپت نصب را قابل اجرا کنید:

```bash
chmod +x install.sh
```

#### **۲. اجرای اسکریپت نصب**

اسکریپت را اجرا کنید. این اسکریپت داکر، پورتینر و سایر نیازمندی‌ها را نصب کرده و یک وردپرس خالی راه‌اندازی می‌کند.

```bash
sudo ./install.sh
```

پس از اتمام، یک وردپرس خام روی دامنه اصلی شما در دسترس است. حالا می‌توانید سناریوی مورد نظر خود را انتخاب کنید.

-----

### **سناریو اول: نصب یک وردپرس خام و جدید**

اگر می‌خواهید یک سایت جدید را از صفر شروع کنید، این مراحل را دنبال کنید.

1.  **تنظیمات DNS:** در کلودفلر، یک رکورد `A` برای دامنه خود بسازید که به **IP سرور شما** اشاره کند و مطمئن شوید ابر نارنجی **فعال** است.
2.  **تنظیمات SSL:** به تب `SSL/TLS` بروید و حالت رمزنگاری را روی **Full (Strict)** قرار دهید.
3.  **نصب وردپرس:** پس از چند دقیقه، به آدرس دامنه خود `https://your-domain.com` بروید و مراحل نصب ۵ دقیقه‌ای وردپرس را تکمیل کنید.

-----

### **سناریو دوم: انتقال یک سایت موجود (روش حرفه‌ای)**

این روش مطمئن‌ترین راه برای انتقال یک سایت وردپرسی موجود است.

1.  **ساخت پکیج در سایت قدیمی:** در سایت **قدیمی** خود، افزونه رایگان **Duplicator** را نصب کرده و یک پکیج شامل فایل **Installer** (`installer.php`) و **Archive** (`.zip`) بسازید و هر دو را دانلود کنید.

2.  **آپلود فایل‌های انتقال:** دو فایلی که دانلود کرده بودید را به پوشه `./data/wordpress/` روی سرور جدید آپلود کنید.

3.  **اجرای نصب‌کننده Duplicator:**

      * در کلودفلر، مطمئن شوید که رکورد `A` دامنه شما به IP سرور اشاره می‌کند و حالت SSL روی **Full (Strict)** است.
      * به آدرس `https://your-domain.com/installer.php` بروید.
      * در بخش Database، اطلاعات دیتابیس را از فایل `.env` خود وارد کنید (Host را `mariadb` قرار دهید) و مراحل را تا انتها دنبال کنید.

4.  **ورود و پاک‌سازی:** پس از اتمام نصب، با نام کاربری و رمز عبور سایت **قدیمی** وارد پیشخوان شوید، فایل‌های نصب‌کننده را پاک کنید و به **تنظیمات \> پیوندهای یکتا** بروید و دو بار روی دک-مه **"ذخیره تغییرات"** کلیک کنید.

-----

## مدیریت پیشرفته سرور 🛠️

در ادامه نحوه مدیریت، توسعه و نگهداری سرور توضیح داده شده است.

### **افزودن یک ساب‌دامین یا دامنه جدید**

شما می‌توانید به راحتی چندین سایت یا ساب‌دامین را روی این سرور میزبانی کنید. فرآیند برای هر دو یکسان است.

1.  **تنظیم DNS:** در کلودفلر، یک رکورد `A` جدید برای دامنه یا ساب‌دامین جدید بسازید که به IP سرور شما اشاره کند.
2.  **ویرایش `docker-compose.yml`:** فایل `docker-compose.yml` را باز کرده و یک سرویس جدید (شامل `nginx`, `wordpress`, `mariadb`) با نام‌ها و پوشه‌های منحصر به فرد به انتهای آن اضافه کنید. در بخش `labels`، آدرس دامنه یا ساب‌دامین جدید خود را در قانون `Host()` وارد کنید.
3.  **اعمال تغییرات:** دستور `sudo docker compose up -d` را اجرا کنید. Traefik به صورت خودکار سرویس جدید را شناسایی کرده و برای آن SSL دریافت می‌کند.

### **بکاپ و بازگردانی 💾**

#### **گرفتن بکاپ کامل**

1.  برای گرفتن بکاپ از تمام فایل‌ها و دیتابیس‌ها، دستور زیر را در پوشه اصلی پروژه اجرا کنید:
    ```bash
    sudo tar -czvf backup-$(date +%Y-%m-%d).tar.gz ./data
    ```
2.  این دستور یک فایل فشرده با نام `backup-YYYY-MM-DD.tar.gz` ایجاد می‌کند. این فایل را دانلود کرده و در جای امنی نگهداری کنید.

#### **بازگردانی بکاپ کامل**

برای بازگردانی سایت روی یک سرور جدید و خام:

1.  **آماده‌سازی اولیه:** پروژه را از گیت‌هاب `clone` کرده و فایل `.env` را با اطلاعات صحیح پر کنید.
2.  **آپلود و استخراج بکاپ:** فایل بکاپ (`.tar.gz`) را در پوشه اصلی پروژه آپلود کرده و با دستور زیر آن را از حالت فشرده خارج کنید:
    ```bash
    sudo tar -xzvf your-backup-file.tar.gz
    ```
3.  **راه‌اندازی سرویس‌ها:** دستور زیر را اجرا کنید تا تمام سرویس‌ها با اطلاعات بکاپ شما بالا بیایند:
    ```bash
    sudo docker compose up -d
    ```

-----

## عیب‌یابی و دستورات مفید ⚙️

  * **مشکل دسترسی فایل‌ها پس از انتقال:**
    اگر بعد از انتقال سایت با افزونه Duplicator یا به صورت دستی، در آپدیت یا نصب افزونه‌ها با خطای دسترسی فایل (File Permissions) مواجه شدید، به این دلیل است که مالکیت فایل‌ها به هم ریخته است. با دستور زیر آن را اصلاح کنید:

    ```bash
    sudo chown -R www-data:www-data ./data/wordpress/
    ```

  * **دستورات مدیریتی:**

      * **مشاهده کانتینرها:** `sudo docker ps`
      * **مشاهده لاگ‌ها:** `sudo docker compose logs -f <service_name>`
      * **متوقف کردن سرویس‌ها:** `sudo docker compose down`
      * **شروع مجدد سرویس‌ها:** `sudo docker compose up -d`

<!-- end list -->
